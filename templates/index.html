<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>üõãÔ∏è –õ—ñ–Ω–∏–≤–∏–π –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä –≤—ñ–¥–º–∞–∑–æ–∫</title>
  <style>
    body {
      background: linear-gradient(to right, #fff5e6, #ffe6f0);
      font-family: 'Comic Sans MS', cursive, sans-serif;
      text-align: center;
      padding: 3rem;
      margin: 0;
    }

    h1 {
      font-size: 3rem;
      color: #d35400;
      margin-bottom: 2rem;
      animation: pop-in 1s ease-out;
    }

    button {
      background-color: #ff6b81;
      color: #fff;
      border: none;
      border-radius: 15px;
      padding: 1.2rem 2rem;
      font-size: 1.5rem;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
      transition: transform 0.1s ease;
    }

    button:hover {
      transform: scale(1.05);
      background-color: #ff4757;
    }

    .excuse {
      margin-top: 2.5rem;
      font-size: 2rem;
      color: #2f3542;
      min-height: 100px;
      animation: fade-in 0.5s ease-in-out;
    }

    #info-panel {
      margin-top: 3rem;
      padding: 1.5rem;
      background: #fff;
      border-radius: 15px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      display: inline-block;
      text-align: left;
      font-size: 1.2rem;
      color: #555;
    }

    ul#top-excuses {
      margin-top: 1rem;
      padding-left: 1.2rem;
    }

    ul#top-excuses li {
      margin: 0.4rem 0;
      font-size: 1rem;
    }

    .footer {
      margin-top: 4rem;
      font-size: 1rem;
      color: #999;
    }

    .meme, #granny-video {
      display: block;
      margin: 2rem auto;
      max-width: 80%;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }

    #granny {
      position: fixed;
      bottom: 20px;
      right: 20px;
      font-size: 2.5rem;
      cursor: pointer;
      z-index: 999;
      transition: transform 0.8s;
    }

    #granny:hover {
      transform: scale(1.2) rotate(-10deg);
    }

    #granny-tip {
      position: fixed;
      top: -100px;
      left: 50%;
      transform: translateX(-50%);
      background: #ffdcdc;
      padding: 1rem 2rem;
      border: 2px solid #ff6b6b;
      border-radius: 12px;
      font-weight: bold;
      font-size: 1.2rem;
      color: #2f2f2f;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      z-index: 1000;
      opacity: 0;
      transition: all 0.8s ease;
    }

    #granny-tip.show {
      top: 20px;
      opacity: 1;
      animation: shake 0.3s ease-in-out;
    }

    @keyframes shake {
      0% { transform: translateX(-50%) translateY(0); }
      25% { transform: translateX(-50%) translateY(-5px); }
      50% { transform: translateX(-50%) translateY(5px); }
      75% { transform: translateX(-50%) translateY(-5px); }
      100% { transform: translateX(-50%) translateY(0); }
    }

    @keyframes pop-in {
      0% { transform: scale(0.5); opacity: 0; }
      100% { transform: scale(1); opacity: 1; }
    }

    @keyframes fade-in {
      from { opacity: 0; transform: translateY(20px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>
  <h1>üõãÔ∏è –ß–æ–º—É —è –Ω—ñ—á–æ–≥–æ –Ω–µ –∑—Ä–æ–±–∏–≤(-–ª–∞)?</h1>
  <button onclick="getExcuse()">üåπ –î–∞–π –º–µ–Ω—ñ –≤—ñ–¥–º–∞–∑–∫—É</button>

  <div class="excuse" id="excuse"><span class="emoji">üò¥</span></div>

  <img id="meme" class="meme" style="display:none;" />
  <video id="granny-video" class="meme" style="display:none;" autoplay playsinline controls muted></video>

  <div id="info-panel">
    <div>üìã –í—Å—å–æ–≥–æ –≤—ñ–¥–º–∞–∑–æ–∫: <span id="excuses-count">...</span></div>
    <div style="margin-top: 0.8rem;">üî• –¢–æ–ø-5 –Ω–∞–π–ø–æ–ø—É–ª—è—Ä–Ω—ñ—à–∏—Ö:</div>
    <ul id="top-excuses"></ul>
  </div>

  <div class="footer">
    üêå –ó—Ä–æ–±–ª–µ–Ω–æ –∑ –ª—é–±–æ–≤'—é —ñ –Ω–µ–π–º–æ–≤—ñ—Ä–Ω–æ—é –ª—ñ–Ω–Ω—é.
  </div>

  <div id="granny" title="üëµ –ù–∞—Ç–∏—Å–Ω–∏ –¥–ª—è —Å—É–≤–æ—Ä–æ—ó –ø–æ—Ä–∞–¥–∏">üëµ</div>
  <div id="granny-tip">üëµ –ü—Ä–∏ –°—Ç–∞–ª—ñ–Ω—ñ —Ç–∞–∫ –Ω–µ –ª—ñ–Ω—É–≤–∞–ª–∏—Å—è.</div>

  <audio id="pop-sound" src="https://www.myinstants.com/media/sounds/pop-cat-original-meme.mp3" preload="auto"></audio>

  <script>
    const emojis = ['üò¥', 'üßï', 'üò≠', 'üòå', 'üôÉ', 'üòé', 'üòÖ', 'ü´†', 'üß¨', 'üí§'];
    const grannyTips = [
      "üëµ –ü—Ä–∏ –°—Ç–∞–ª—ñ–Ω—ñ —Ç–∞–∫ –Ω–µ –ª—ñ–Ω—É–≤–∞–ª–∏—Å—è.",
      "üëµ –í –º–æ—ó —Ä–æ–∫–∏ –≤–∂–µ –ø–æ –¥–≤–∞ –¥—ñ—Ç–∏ –±—É–ª–æ.",
      "üëµ –°–∏–¥–∏—à —Ç—É—Ç... –ê –∫–∞—Ä—Ç–æ–ø–ª—é —Ö—Ç–æ –∫–æ–ø–∞—Ç–∏ –±—É–¥–µ?",
      "üëµ –©–µ –æ–¥–Ω–∞ –≤—ñ–¥–º–∞–∑–∫–∞ —ñ —è –∫–ª–∏—á—É –¥—ñ–¥–∞.",
      "üëµ –•–æ—á —â–æ—Å—å –∑–∞ –¥–µ–Ω—å –∑—Ä–æ–±–∏.",
      "üëµ –ö–∞–∫—Ç—É—Å –±—ñ–ª—å—à–µ —Ä—É—Ö–∞—î—Ç—å—Å—è, –Ω—ñ–∂ —Ç–∏.",
      "üëµ –û—Ç–æ –≤–∏—Ä–æ—Å–ª–æ –ø–æ–∫–æ–ª—ñ–Ω–Ω—è –∫–Ω–æ–ø–∫–æ–¥–∞–≤—ñ–≤.",
      "üëµ –ë–æ–∂–µ... —è–∫–µ –∫–æ–Ω—á–µ–Ω–µ.",
      "üëµ –ë–æ–≥ –¥–∏–≤–∏—Ç—å—Å—è —ñ –ø–ª–∞—á–µ."
    ];

    const excuseEl = document.getElementById("excuse");
    const memeImg = document.getElementById("meme");
    const grannyVideo = document.getElementById("granny-video");
    const excusesCountEl = document.getElementById("excuses-count");
    const topListEl = document.getElementById("top-excuses");
    const popSound = document.getElementById("pop-sound");
    const granny = document.getElementById("granny");
    const tip = document.getElementById("granny-tip");

    async function getExcuse() {
      const randomEmoji = emojis[Math.floor(Math.random() * emojis.length)];
      excuseEl.innerHTML = `<span class='emoji'>${randomEmoji}</span> –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...`;
      memeImg.style.display = "none";
      grannyVideo.style.display = "none";

      try {
        const res = await fetch("/random-excuse");
        const data = await res.json();
        popSound.play();
        excuseEl.innerHTML = "üçã " + data.text;

        if (data.meme_url) {
          memeImg.src = data.meme_url;
          memeImg.style.display = "block";
        }

        loadStats();
      } catch (err) {
        excuseEl.innerHTML = "‚ùå –ù–µ –≤–¥–∞–ª–æ—Å—è –∑–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏.";
      }
    }

    async function loadStats() {
      try {
        const res = await fetch("/excuses-stats");
        const data = await res.json();
        excusesCountEl.innerText = data.total;
        topListEl.innerHTML = "";
        data.top.forEach((item, index) => {
          const li = document.createElement("li");
          li.innerText = `${index + 1}. ${item.text} (${item.rating} —Ä–∞–∑—ñ–≤)`;
          topListEl.appendChild(li);
        });
      } catch (err) {
        console.error("–ü–æ–º–∏–ª–∫–∞ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:", err);
      }
    }

    granny.addEventListener("click", () => {
      const randomTip = grannyTips[Math.floor(Math.random() * grannyTips.length)];
      tip.innerText = randomTip;
      tip.classList.add("show");

      if (randomTip.includes("–ë–æ–∂–µ")) {
        grannyVideo.src = "/static/granny/bozhe.mp4";
        grannyVideo.style.display = "block";
        memeImg.style.display = "none";
        grannyVideo.muted = false;
        grannyVideo.play();

        grannyVideo.onended = () => {
          tip.classList.remove("show");
          grannyVideo.style.display = "none";
        };
      } else {
        const gifs = Array.from({ length: 9 }, (_, i) => `/static/granny/${i + 1}.gif`);
        const gif = gifs[Math.floor(Math.random() * gifs.length)];
        memeImg.src = gif;
        memeImg.style.display = "block";
        grannyVideo.pause();
        grannyVideo.style.display = "none";

        setTimeout(() => {
          tip.classList.remove("show");
          memeImg.style.display = "none";
        }, 15000);
      }
    });

    loadStats();
  </script>
</body>
</html>